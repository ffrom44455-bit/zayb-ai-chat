<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zayb AI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.3/purify.min.js"></script>

    <script>
        tailwind.config = {
            theme: { extend: { colors: { brand: { 500: '#0ea5e9', 600: '#0284c7' } } } }
        }
    </script>
    
    <style>
        .prose pre { background: #1e293b; color: #fff; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 10px 0; }
        .prose code { background: #f1f5f9; padding: 2px 4px; border-radius: 4px; color: #e11d48; font-size: 0.9em; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .message-header { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen flex overflow-hidden">

    <aside id="sidebar" class="transition-transform duration-300 bg-gray-900 text-gray-300 w-72 flex-shrink-0 flex flex-col absolute md:relative z-30 h-full -translate-x-full md:translate-x-0">
        <div class="p-4 border-b border-gray-800 flex justify-between items-center">
            <span class="text-white font-bold text-xl"><i class="fa-solid fa-robot text-brand-500 mr-2"></i>Zayb AI</span>
            <button id="close-sidebar" class="md:hidden text-gray-400"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="p-4">
            <button id="new-chat-btn" class="w-full bg-gray-800 hover:bg-gray-700 text-white py-2 px-4 rounded-lg flex items-center justify-center border border-gray-700 transition">
                <i class="fa-solid fa-plus mr-2"></i> New Chat
            </button>
        </div>
        <div id="chat-list" class="flex-1 overflow-y-auto px-2 space-y-1"></div>
        <div class="p-4 border-t border-gray-800 text-xs text-gray-400 text-center italic">
            Developed by <span class="text-brand-500 font-bold">Zayb</span>
        </div>
    </aside>

    <main class="flex-1 flex flex-col min-w-0 relative">
        <header class="h-16 border-b bg-white flex items-center justify-between px-4 z-20">
            <div class="flex items-center">
                <button id="open-sidebar" class="md:hidden mr-4 text-gray-600"><i class="fa-solid fa-bars text-xl"></i></button>
                <h2 id="header-title" class="font-semibold truncate max-w-[200px]">New Conversation</h2>
            </div>
            <button id="open-settings" class="p-2 hover:bg-gray-100 rounded-full text-gray-500 transition">
                <i class="fa-solid fa-gear text-xl"></i>
            </button>
        </header>

        <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 pb-32">
            <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center space-y-4">
                <div class="w-16 h-16 bg-brand-500 rounded-2xl flex items-center justify-center text-white text-3xl shadow-lg">Z</div>
                <h1 class="text-2xl font-bold">Zayb AI</h1>
                <p id="welcome-text" class="text-gray-500 max-w-sm">Ready to assist you.</p>
            </div>
        </div>

        <div class="absolute bottom-0 w-full p-4 bg-gradient-to-t from-gray-50 via-gray-50">
            <form id="chat-form" class="max-w-4xl mx-auto flex items-end gap-2 bg-white rounded-2xl shadow-xl border border-gray-200 p-2 focus-within:ring-2 focus-within:ring-brand-500 transition-all">
                <textarea id="user-input" rows="1" placeholder="Type your message..." class="flex-1 p-3 bg-transparent outline-none resize-none max-h-40"></textarea>
                <button type="submit" id="send-btn" class="bg-brand-500 hover:bg-brand-600 text-white w-12 h-12 rounded-xl flex items-center justify-center transition">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </main>

    <div id="modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden">
            <div class="p-6 border-b flex justify-between items-center bg-gray-50">
                <h3 class="text-lg font-bold" id="modal-title">Setup Zayb AI</h3>
            </div>
            <form id="settings-form" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Your Name</label>
                    <input type="text" id="user-name" class="w-full border rounded-lg p-2.5 outline-none focus:ring-2 focus:ring-brand-500" placeholder="Enter your name" required>
                </div>
                <div id="api-section">
                    <label class="block text-sm font-medium mb-1">OpenRouter API Key</label>
                    <input type="password" id="api-key" class="w-full border rounded-lg p-2.5 outline-none focus:ring-2 focus:ring-brand-500" placeholder="sk-or-v1-...">
                </div>
                <button type="submit" class="w-full bg-brand-500 text-white py-2.5 rounded-lg font-bold hover:bg-brand-600 transition">Save Configuration</button>
            </form>
        </div>
    </div>

    <script>
        const store = {
            get: (k) => localStorage.getItem(k),
            set: (k, v) => localStorage.setItem(k, v)
        };

        let state = {
            name: store.get('z_name') || '',
            apiKey: store.get('z_key') || '',
            model: store.get('z_model') || 'google/gemini-2.0-flash-exp:free',
            chats: JSON.parse(store.get('z_chats') || '[]'),
            activeId: null,
            loading: false
        };

        const dom = {
            sidebar: document.getElementById('sidebar'),
            chatList: document.getElementById('chat-list'),
            chatWindow: document.getElementById('chat-window'),
            chatForm: document.getElementById('chat-form'),
            userInput: document.getElementById('user-input'),
            headerTitle: document.getElementById('header-title'),
            modal: document.getElementById('modal-overlay'),
            settingsForm: document.getElementById('settings-form'),
            nameInput: document.getElementById('user-name'),
            apiKeyInput: document.getElementById('api-key'),
            welcome: document.getElementById('welcome-screen'),
            welcomeText: document.getElementById('welcome-text')
        };

        function init() {
            document.getElementById('open-sidebar').onclick = () => dom.sidebar.classList.remove('-translate-x-full');
            document.getElementById('close-sidebar').onclick = () => dom.sidebar.classList.add('-translate-x-full');
            document.getElementById('new-chat-btn').onclick = createNewChat;
            document.getElementById('open-settings').onclick = () => {
                dom.nameInput.value = state.name;
                dom.apiKeyInput.value = state.apiKey;
                dom.modal.classList.remove('hidden');
            };

            dom.settingsForm.onsubmit = (e) => {
                e.preventDefault();
                state.name = dom.nameInput.value.trim();
                state.apiKey = dom.apiKeyInput.value.trim();
                store.set('z_name', state.name);
                store.set('z_key', state.apiKey);
                dom.modal.classList.add('hidden');
                updateWelcome();
                if(!state.activeId) createNewChat();
            };

            dom.userInput.oninput = function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            };

            dom.chatForm.onsubmit = handleSend;

            renderSidebar();
            if (state.chats.length > 0) loadChat(state.chats[0].id);
            if (!state.apiKey || !state.name) dom.modal.classList.remove('hidden');
            updateWelcome();
        }

        function updateWelcome() {
            if(state.name) dom.welcomeText.innerText = `Hello, ${state.name}! How can Zayb AI help you today?`;
        }

        function createNewChat() {
            const id = Date.now().toString();
            state.chats.unshift({ id, title: 'New Chat', messages: [] });
            save();
            renderSidebar();
            loadChat(id);
        }

        function loadChat(id) {
            state.activeId = id;
            const chat = state.chats.find(c => c.id === id);
            dom.headerTitle.innerText = chat.title;
            dom.chatWindow.innerHTML = '';
            if (chat.messages.length === 0) {
                dom.chatWindow.appendChild(dom.welcome);
            } else {
                chat.messages.forEach(m => appendUI(m.role, m.content));
            }
            renderSidebar();
            scrollToBottom();
        }

        function appendUI(role, text) {
            if(dom.chatWindow.contains(dom.welcome)) dom.welcome.remove();
            
            const wrapper = document.createElement('div');
            wrapper.className = `flex flex-col ${role === 'user' ? 'items-end' : 'items-start'} mb-6`;
            
            // Added Identity Headers
            const header = document.createElement('div');
            header.className = `message-header ${role === 'user' ? 'text-brand-600' : 'text-gray-500'}`;
            header.innerText = role === 'user' ? state.name : 'Zayb AI';
            
            const bubble = document.createElement('div');
            if(role === 'user') {
                bubble.className = "bg-brand-500 text-white px-4 py-2.5 rounded-2xl rounded-tr-none max-w-[85%] shadow-sm";
                bubble.textContent = text;
            } else {
                bubble.className = "bg-white border border-gray-100 px-5 py-4 rounded-2xl rounded-tl-none max-w-[95%] shadow-sm prose prose-sm leading-relaxed";
                bubble.innerHTML = DOMPurify.sanitize(marked.parse(text));
            }
            
            wrapper.appendChild(header);
            wrapper.appendChild(bubble);
            dom.chatWindow.appendChild(wrapper);
            scrollToBottom();
        }

        async function handleSend(e) {
            e.preventDefault();
            const text = dom.userInput.value.trim();
            if (!text || state.loading || !state.apiKey) return;

            state.loading = true;
            dom.userInput.value = '';
            dom.userInput.style.height = 'auto';
            
            const chat = state.chats.find(c => c.id === state.activeId);
            if (chat.messages.length === 0) chat.title = text.substring(0, 25) + '...';
            
            chat.messages.push({ role: 'user', content: text });
            appendUI('user', text);
            
            const loadingId = addLoading();

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${state.apiKey}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: state.model,
                        messages: [{role: "system", content: `You are Zayb AI. You are talking to ${state.name}.`}, ...chat.messages]
                    })
                });

                const data = await res.json();
                document.getElementById(loadingId).remove();

                if (data.error) throw new Error(data.error.message);

                const aiMsg = data.choices[0].message.content;
                chat.messages.push({ role: 'assistant', content: aiMsg });
                appendUI('assistant', aiMsg);
                save();
                renderSidebar();
            } catch (err) {
                document.getElementById(loadingId)?.remove();
                appendUI('assistant', `**Error:** ${err.message}`);
            } finally {
                state.loading = false;
            }
        }

        function addLoading() {
            const id = 'loader-' + Date.now();
            const loader = document.createElement('div');
            loader.id = id;
            loader.className = "flex flex-col items-start mb-6";
            loader.innerHTML = `
                <div class="message-header text-gray-500">Zayb AI</div>
                <div class="bg-white border border-gray-100 px-4 py-3 rounded-2xl flex gap-1 items-center shadow-sm">
                    <div class="typing-dot w-1.5 h-1.5 bg-brand-500 rounded-full"></div>
                    <div class="typing-dot w-1.5 h-1.5 bg-brand-500 rounded-full" style="animation-delay:0.2s"></div>
                    <div class="typing-dot w-1.5 h-1.5 bg-brand-500 rounded-full" style="animation-delay:0.4s"></div>
                </div>`;
            dom.chatWindow.appendChild(loader);
            scrollToBottom();
            return id;
        }

        function renderSidebar() {
            dom.chatList.innerHTML = '';
            state.chats.forEach(c => {
                const b = document.createElement('button');
                b.className = `w-full text-left p-3 rounded-lg truncate text-sm transition mb-1 ${c.id === state.activeId ? 'bg-gray-800 text-white' : 'hover:bg-gray-800/50 text-gray-400'}`;
                b.innerHTML = `<i class="fa-regular fa-message mr-2 text-brand-500"></i> ${c.title}`;
                b.onclick = () => loadChat(c.id);
                dom.chatList.appendChild(b);
            });
        }

        function save() { store.set('z_chats', JSON.stringify(state.chats)); }
        function scrollToBottom() { dom.chatWindow.scrollTo({ top: dom.chatWindow.scrollHeight, behavior: 'smooth' }); }

        init();
    </script>
</body>
          </html>
  
