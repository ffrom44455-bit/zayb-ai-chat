<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zayb AI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.3/purify.min.js"></script>

    <script>
        tailwind.config = {
            theme: { extend: { colors: { brand: { 500: '#0ea5e9', 600: '#0284c7' } } } }
        }
    </script>
    
    <style>
        .prose pre { background: #1e293b; color: #fff; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 10px 0; }
        .prose code { background: #f1f5f9; padding: 2px 4px; border-radius: 4px; color: #e11d48; font-size: 0.9em; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .message-header { font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.2rem; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen flex overflow-hidden font-sans">

    <aside id="sidebar" class="transition-transform duration-300 bg-gray-900 text-gray-300 w-72 flex-shrink-0 flex flex-col absolute md:relative z-30 h-full -translate-x-full md:translate-x-0">
        <div class="p-4 border-b border-gray-800 flex justify-between items-center">
            <span class="text-white font-bold text-xl"><i class="fa-solid fa-bolt text-brand-500 mr-2"></i>Zayb AI</span>
            <button id="close-sidebar" class="md:hidden text-gray-400"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="p-4">
            <button id="new-chat-btn" class="w-full bg-gray-800 hover:bg-gray-700 text-white py-2.5 px-4 rounded-xl flex items-center justify-center border border-gray-700 transition shadow-sm">
                <i class="fa-solid fa-plus mr-2 text-xs"></i> New Chat
            </button>
        </div>
        <div id="chat-list" class="flex-1 overflow-y-auto px-2 space-y-1"></div>
        <div class="p-4 border-t border-gray-800 text-xs text-center">
            <div class="text-gray-500 mb-1 uppercase tracking-widest text-[10px]">Interface by</div>
            <div class="text-white font-bold text-lg tracking-tighter">ZAYB <span class="text-brand-500">AI</span></div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col min-w-0 relative">
        <header class="h-16 border-b bg-white flex items-center justify-between px-6 z-20 shadow-sm">
            <div class="flex items-center gap-3">
                <button id="open-sidebar" class="md:hidden text-gray-600"><i class="fa-solid fa-bars-staggered text-xl"></i></button>
                <div>
                    <h2 id="header-title" class="font-bold text-gray-900 truncate max-w-[180px]">New Conversation</h2>
                    <p id="active-model-display" class="text-[10px] text-brand-600 font-bold uppercase tracking-wide"></p>
                </div>
            </div>
            <button id="open-settings" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-full text-gray-500 transition">
                <i class="fa-solid fa-sliders text-lg"></i>
            </button>
        </header>

        <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 pb-32">
            <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center space-y-4">
                <div class="w-20 h-20 bg-brand-500 rounded-3xl flex items-center justify-center text-white text-4xl shadow-2xl rotate-3">Z</div>
                <h1 class="text-3xl font-black text-gray-900">Zayb AI</h1>
                <p id="welcome-text" class="text-gray-500 max-w-sm font-medium">Please configure your settings to start.</p>
            </div>
        </div>

        <div class="absolute bottom-0 w-full p-4 bg-gradient-to-t from-gray-50 via-gray-50">
            <form id="chat-form" class="max-w-4xl mx-auto flex items-end gap-2 bg-white rounded-2xl shadow-2xl border border-gray-100 p-2 focus-within:ring-2 focus-within:ring-brand-500 transition-all">
                <textarea id="user-input" rows="1" placeholder="Ask Zayb AI anything..." class="flex-1 p-3 bg-transparent outline-none resize-none max-h-40 font-medium"></textarea>
                <button type="submit" id="send-btn" class="bg-brand-500 hover:bg-brand-600 text-white w-12 h-12 rounded-xl flex items-center justify-center transition shadow-lg shadow-brand-500/30">
                    <i class="fa-solid fa-arrow-up"></i>
                </button>
            </form>
        </div>
    </main>

    <div id="modal-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full max-w-md shadow-2xl overflow-hidden border border-white/20">
            <div class="p-6 border-b flex justify-between items-center bg-gray-50/50">
                <h3 class="text-xl font-black text-gray-900">Configuration</h3>
                <button id="close-settings" class="text-gray-400 hover:text-gray-800"><i class="fa-solid fa-circle-xmark text-xl"></i></button>
            </div>
            <form id="settings-form" class="p-6 space-y-5">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Your Name</label>
                    <input type="text" id="user-name" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-brand-500 font-bold" placeholder="E.g. Alex" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">API Key</label>
                    <input type="password" id="api-key" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-brand-500 font-mono text-sm" placeholder="sk-or-v1-...">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Choose AI Model</label>
                    <select id="model-select" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-brand-500 font-bold appearance-none">
                        <option value="google/gemini-2.0-flash-exp:free">Gemini 2.0 Flash (Free)</option>
                        <option value="meta-llama/llama-3.1-8b-instruct:free">Llama 3.1 8B (Free)</option>
                        <option value="mistralai/mistral-7b-instruct:free">Mistral 7B (Free)</option>
                        <option value="openai/gpt-4o-mini">GPT-4o Mini</option>
                        <option value="anthropic/claude-3-haiku">Claude 3 Haiku</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-brand-500 text-white py-4 rounded-2xl font-black hover:bg-brand-600 transition-all shadow-lg shadow-brand-500/40 uppercase tracking-widest">Update Zayb AI</button>
            </form>
        </div>
    </div>

    <script>
        const store = {
            get: (k) => localStorage.getItem(k),
            set: (k, v) => localStorage.setItem(k, v)
        };

        let state = {
            name: store.get('z_name') || '',
            apiKey: store.get('z_key') || '',
            model: store.get('z_model') || 'google/gemini-2.0-flash-exp:free',
            chats: JSON.parse(store.get('z_chats') || '[]'),
            activeId: null,
            loading: false
        };

        const dom = {
            sidebar: document.getElementById('sidebar'),
            chatList: document.getElementById('chat-list'),
            chatWindow: document.getElementById('chat-window'),
            chatForm: document.getElementById('chat-form'),
            userInput: document.getElementById('user-input'),
            headerTitle: document.getElementById('header-title'),
            modelDisplay: document.getElementById('active-model-display'),
            modal: document.getElementById('modal-overlay'),
            settingsForm: document.getElementById('settings-form'),
            nameInput: document.getElementById('user-name'),
            apiKeyInput: document.getElementById('api-key'),
            modelSelect: document.getElementById('model-select'),
            welcome: document.getElementById('welcome-screen'),
            welcomeText: document.getElementById('welcome-text')
        };

        function init() {
            document.getElementById('open-sidebar').onclick = () => dom.sidebar.classList.remove('-translate-x-full');
            document.getElementById('close-sidebar').onclick = () => dom.sidebar.classList.add('-translate-x-full');
            document.getElementById('new-chat-btn').onclick = createNewChat;
            document.getElementById('open-settings').onclick = () => {
                dom.nameInput.value = state.name;
                dom.apiKeyInput.value = state.apiKey;
                dom.modelSelect.value = state.model;
                dom.modal.classList.remove('hidden');
            };
            document.getElementById('close-settings').onclick = () => dom.modal.classList.add('hidden');

            dom.settingsForm.onsubmit = (e) => {
                e.preventDefault();
                state.name = dom.nameInput.value.trim();
                state.apiKey = dom.apiKeyInput.value.trim();
                state.model = dom.modelSelect.value;
                store.set('z_name', state.name);
                store.set('z_key', state.apiKey);
                store.set('z_model', state.model);
                dom.modal.classList.add('hidden');
                updateUIState();
                if(!state.activeId) createNewChat();
            };

            dom.userInput.oninput = function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            };

            dom.chatForm.onsubmit = handleSend;

            renderSidebar();
            if (state.chats.length > 0) loadChat(state.chats[0].id);
            if (!state.apiKey || !state.name) dom.modal.classList.remove('hidden');
            updateUIState();
        }

        function updateUIState() {
            if(state.name) dom.welcomeText.innerText = `Hello, ${state.name}! Ready to explore ${state.model.split('/')[1].split(':')[0]}?`;
            dom.modelDisplay.innerText = state.model.split('/')[1].replace(':free', '');
        }

        function createNewChat() {
            const id = Date.now().toString();
            state.chats.unshift({ id, title: 'Fresh Talk', messages: [] });
            save();
            renderSidebar();
            loadChat(id);
        }

        function loadChat(id) {
            state.activeId = id;
            const chat = state.chats.find(c => c.id === id);
            dom.headerTitle.innerText = chat.title;
            dom.chatWindow.innerHTML = '';
            if (chat.messages.length === 0) {
                dom.chatWindow.appendChild(dom.welcome);
            } else {
                chat.messages.forEach(m => appendUI(m.role, m.content));
            }
            renderSidebar();
            scrollToBottom();
        }

        function appendUI(role, text) {
            if(dom.chatWindow.contains(dom.welcome)) dom.welcome.remove();
            
            const wrapper = document.createElement('div');
            wrapper.className = `flex flex-col ${role === 'user' ? 'items-end' : 'items-start'} mb-8`;
            
            const header = document.createElement('div');
            header.className = `message-header ${role === 'user' ? 'text-brand-600' : 'text-gray-400'}`;
            header.innerText = role === 'user' ? state.name : 'Zayb AI';
            
            const bubble = document.createElement('div');
            if(role === 'user') {
                bubble.className = "bg-brand-500 text-white px-5 py-3 rounded-2xl rounded-tr-none max-w-[85%] shadow-lg font-medium";
                bubble.textContent = text;
            } else {
                bubble.className = "bg-white border border-gray-100 px-6 py-5 rounded-2xl rounded-tl-none max-w-[95%] shadow-sm prose prose-sm leading-relaxed text-gray-800 font-medium";
                bubble.innerHTML = DOMPurify.sanitize(marked.parse(text));
            }
            
            wrapper.appendChild(header);
            wrapper.appendChild(bubble);
            dom.chatWindow.appendChild(wrapper);
            scrollToBottom();
        }

        async function handleSend(e) {
            e.preventDefault();
            const text = dom.userInput.value.trim();
            if (!text || state.loading || !state.apiKey) return;

            state.loading = true;
            dom.userInput.value = '';
            dom.userInput.style.height = 'auto';
            
            const chat = state.chats.find(c => c.id === state.activeId);
            if (chat.messages.length === 0) chat.title = text.substring(0, 20) + '...';
            
            chat.messages.push({ role: 'user', content: text });
            appendUI('user', text);
            
            const loadingId = addLoading();

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${state.apiKey}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: state.model,
                        messages: [{role: "system", content: `You are Zayb AI, a helpful assistant. You are speaking to ${state.name}.`}, ...chat.messages]
                    })
                });

                const data = await res.json();
                document.getElementById(loadingId).remove();

                if (data.error) throw new Error(data.error.message);

                const aiMsg = data.choices[0].message.content;
                chat.messages.push({ role: 'assistant', content: aiMsg });
                appendUI('assistant', aiMsg);
                save();
                renderSidebar();
            } catch (err) {
                document.getElementById(loadingId)?.remove();
                appendUI('assistant', `**Attention:** ${err.message}`);
            } finally {
                state.loading = false;
            }
        }

        function addLoading() {
            const id = 'loader-' + Date.now();
            const loader = document.createElement('div');
            loader.id = id;
            loader.className = "flex flex-col items-start mb-8";
            loader.innerHTML = `
                <div class="message-header text-gray-400 uppercase">Zayb AI</div>
                <div class="bg-white border border-gray-100 px-5 py-4 rounded-2xl flex gap-1.5 items-center shadow-sm">
                    <div class="typing-dot w-2 h-2 bg-brand-500 rounded-full"></div>
                    <div class="typing-dot w-2 h-2 bg-brand-500 rounded-full" style="animation-delay:0.2s"></div>
                    <div class="typing-dot w-2 h-2 bg-brand-500 rounded-full" style="animation-delay:0.4s"></div>
                </div>`;
            dom.chatWindow.appendChild(loader);
            scrollToBottom();
            return id;
        }

        function renderSidebar() {
            dom.chatList.innerHTML = '';
            state.chats.forEach(c => {
                const b = document.createElement('button');
                b.className = `w-full text-left p-3.5 rounded-xl truncate text-sm transition-all mb-1 font-bold ${c.id === state.activeId ? 'bg-brand-500 text-white shadow-lg shadow-brand-500/20' : 'hover:bg-gray-800 text-gray-500 hover:text-white'}`;
                b.innerHTML = `<i class="fa-solid fa-message mr-2 opacity-70"></i> ${c.title}`;
                b.onclick = () => loadChat(c.id);
                dom.chatList.appendChild(b);
            });
        }

        function save() { store.set('z_chats', JSON.stringify(state.chats)); }
        function scrollToBottom() { dom.chatWindow.scrollTo({ top: dom.chatWindow.scrollHeight, behavior: 'smooth' }); }

        init();
    </script>
</body>
        </html>
                            
